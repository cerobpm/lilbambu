begin;
create temporary table datavalues_tmp ("LocalDateTime" timestamp,"DateTimeUTC" timestamp,"DataValue" float,"UTCOffset" integer,"SiteCode" varchar,"VariableCode" varchar,"Qualifier" varchar,"MethodCode" varchar,"SourceCode" varchar,"QualityControlLevelCode" integer);
copy datavalues_tmp from stdin;
insert into "DataValues" select "LocalDateTime","DateTimeUTC","DataValue","UTCOffset","Sites"."SiteID","Variables"."VariableID","Qualifiers"."Qualifier",coalesce("Methods"."MethodCode",0),coalesce("Sources"."SourceID",0) ,coalesce("QualityControlLevels"."QualityControlLevelID",0) from datavalues_tmp  join "Sites" on (datavalues_tmp."SiteCode"="Sites"."SiteCode") join "Variables" on (datavalues_tmp."VariableCode"="Variables"."VariableCode") left join "Methods" on (datavalues_tmp."MethodCode"="Methods"."MethodCode") left join "Sources" on (datavalues_tmp."SourceCode"="Sources"."SourceCode") left join "QualityControlLevels" on (datavalues_tmp."QualityControlLevelCode"="QualityControlLevels"."QualityControlLevelCode") left join "Qualifiers" on (datavalues_tmp."Qualifier"="Qualifiers"."QualifierCode") on conflict ("SiteID", "VariableID", "SourceID", "DateTimeUTC") do nothing returning count("SiteID");
commit; 
